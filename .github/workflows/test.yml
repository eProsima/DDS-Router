# Tests to run with workflow-dispatch, pull-request and push events
name: test

on:
  workflow_dispatch:
    inputs:

      custom_version_build:
        description: >
          Use the custom version build from eProsima-CI.
          If set to false, the workflow will run the tests for Fast DDS v2 and v3.
        required: true
        type: choice
        default: 'custom'
        options:
          - custom
          - v2
          - v3

      dependencies_artifact_postfix:
        description: 'Postfix name to add to artifact name to download dependencies. This is use to download a specific artifact version from eProsima-CI.'
        required: true
        default: '_nightly'

  pull_request:
  push:
    branches:
      - main

jobs:

  reusable_tests:
    name: reusable_tests
    uses: ./.github/workflows/reusable-workflow.yml
    with:
      custom_version_build: ${{ inputs.custom_version_build || 'v2' }}
      dependencies_artifact_postfix: ${{ inputs.dependencies_artifact_postfix || '_nightly' }}
    secrets: inherit

  reusable_docker_tests:
    name: reusable_docker_tests
    uses: ./.github/workflows/docker-reusable-workflow.yml
    with:
      fastcdr_branch: 'master'
      fastdds_branch: '2.x'
      ddspipe_branch: 'main'
      ddsrouter_branch: ${{ inputs.ddsrouter_branch || github.head_ref }}
      custom_version_build: ${{ inputs.custom_version_build || 'v2' }}
      dependencies_artifact_postfix: ${{ inputs.dependencies_artifact_postfix || '_nightly' }}
    secrets: inherit
